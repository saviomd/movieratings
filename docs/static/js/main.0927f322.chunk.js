(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{24:function(e,t,a){e.exports=a(36)},36:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(21),o=a.n(i),c=a(38),s=a(8),l=a(9),m=a(11),v=a(10),d=a(12),u=a(39),g=a(23),h=a(14),b=a(7),f=a(2);function p(e,t){return e.filter(function(e){return e.Name.toLowerCase().includes(t.toLowerCase())})}function E(e){return e.reverse(),e=e.map(function(e,t){return e.Id=e.LetterboxdURI.length?e.LetterboxdURI.split("/film/")[1].split("/")[0]:t.toString(),e.Name=e.Name.toString(),e.DateFormatted=new Date(e.Date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),e.WatchedDate&&(e.WatchedDateFormatted=new Date(e.WatchedDate).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})),e})}var y=r.a.createContext(),S=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={getMovieDiaryFiltered:a.getMovieDiaryFiltered.bind(Object(f.a)(Object(f.a)(a))),getMovieDiaryPaginated:a.getMovieDiaryPaginated.bind(Object(f.a)(Object(f.a)(a))),getMoviesPerYearWatched:a.getMoviesPerYearWatched.bind(Object(f.a)(Object(f.a)(a))),increaseMovieDiaryPage:a.increaseMovieDiaryPage.bind(Object(f.a)(Object(f.a)(a))),movieDiary:[],movieDiaryPage:1,movieDiarySearchString:"",movieDiaryStatus:"",setMovieDiarySearchString:a.setMovieDiarySearchString.bind(Object(f.a)(Object(f.a)(a)))},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.loadMovieDiary()}},{key:"getMovieDiaryFiltered",value:function(){var e=this.state;return p(e.movieDiary,e.movieDiarySearchString)}},{key:"getMovieDiaryPaginated",value:function(){var e=100*this.state.movieDiaryPage;return this.getMovieDiaryFiltered().slice(0,e)}},{key:"getMoviesPerYearWatched",value:function(){var e=this.state.movieDiary.reduce(function(e,t){var a=t.WatchedDate.split("-")[0];return e[a]?e[a]++:e[a]=1,e},{}),t=0;for(var a in e)t=e[a]>t?e[a]:t;return{groups:e,max:t}}},{key:"increaseMovieDiaryPage",value:function(){var e=this.state.movieDiaryPage;this.setState({movieDiaryPage:e+1})}},{key:"loadMovieDiary",value:function(){var e=this;return this.setState({movieDiaryStatus:"loading"}),fetch("https://saviomd.com/movieratings/data/diary.json").then(function(e){if(!e.ok)throw Error(e.status);return e.json()}).then(function(t){var a=E(t);return e.setState({movieDiary:a,movieDiaryStatus:"loaded"}),a}).catch(function(t){e.setState({movieDiaryStatus:"error"}),console.log(t.message)})}},{key:"setMovieDiarySearchString",value:function(e){e.trim().toLowerCase(),this.setState({movieDiarySearchString:e})}},{key:"render",value:function(){var e=this.props.children;return r.a.createElement(y.Provider,{value:this.state},e)}}]),t}(r.a.Component),N=r.a.createContext(),w=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={getMovieRatingsFiltered:a.getMovieRatingsFiltered.bind(Object(f.a)(Object(f.a)(a))),getMovieRatingsPaginated:a.getMovieRatingsPaginated.bind(Object(f.a)(Object(f.a)(a))),getMoviesPerDecadeReleased:a.getMoviesPerDecadeReleased.bind(Object(f.a)(Object(f.a)(a))),getMoviesPerRatingGiven:a.getMoviesPerRatingGiven.bind(Object(f.a)(Object(f.a)(a))),increaseMovieRatingsPage:a.increaseMovieRatingsPage.bind(Object(f.a)(Object(f.a)(a))),movieRatings:[],movieRatingsPage:1,movieRatingsSearchString:"",movieRatingsStatus:"",setMovieRatingsSearchString:a.setMovieRatingsSearchString.bind(Object(f.a)(Object(f.a)(a)))},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.loadMovieRatings()}},{key:"getMovieRatingsFiltered",value:function(){var e=this.state;return p(e.movieRatings,e.movieRatingsSearchString)}},{key:"getMovieRatingsPaginated",value:function(){var e=100*this.state.movieRatingsPage;return this.getMovieRatingsFiltered().slice(0,e)}},{key:"getMoviesPerDecadeReleased",value:function(){var e=this.state.movieRatings.reduce(function(e,t){var a="".concat(t.Year.toString().substr(0,3),"0");return e[a]?e[a]++:e[a]=1,e},{}),t=0;for(var a in e)t=e[a]>t?e[a]:t;return{groups:e,max:t}}},{key:"getMoviesPerRatingGiven",value:function(){var e=this.state.movieRatings.reduce(function(e,t){var a=t.Rating;return e[a]?e[a]++:e[a]=1,e},{}),t=0;for(var a in e)t=e[a]>t?e[a]:t;return{groups:e,max:t}}},{key:"increaseMovieRatingsPage",value:function(){var e=this.state.movieRatingsPage;this.setState({movieRatingsPage:e+1})}},{key:"loadMovieRatings",value:function(){var e=this;return this.setState({movieRatingsStatus:"loading"}),fetch("https://saviomd.com/movieratings/data/ratings.json").then(function(e){if(!e.ok)throw Error(e.status);return e.json()}).then(function(t){var a=E(t);return e.setState({movieRatings:a,movieRatingsStatus:"loaded"}),a}).catch(function(t){e.setState({movieRatingsStatus:"error"}),console.log(t.message)})}},{key:"setMovieRatingsSearchString",value:function(e){e.trim().toLowerCase(),this.setState({movieRatingsSearchString:e})}},{key:"render",value:function(){var e=this.props.children;return r.a.createElement(N.Provider,{value:this.state},e)}}]),t}(r.a.Component),M=function(){var e=(new Date).getFullYear();return r.a.createElement("footer",{className:"border-secondary border-top mb-3 pt-3 small text-center"},"\xa9 2017-",e,r.a.createElement("a",{className:"ml-1 text-danger",href:"http://saviomd.com/",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{alt:"saviomd.com",className:"mr-1",src:"https://saviomd.com/img/favicon.png",height:"15",width:"15"}),"S\xe1vio Mendes"))},R=a(37),D=a(4),k=function(e){var t=e.link;return r.a.createElement(R.a,{to:t.path,exact:!0,activeClassName:"active",className:"btn btn-danger btn-sm"},r.a.createElement(D.a,{icon:t.icon}),r.a.createElement("span",{className:"d-none d-sm-inline-block ml-1"},t.name))},j=function(e){var t=e.navLinks;return r.a.createElement("nav",{className:"btn-group"},t.map(function(e){return r.a.createElement(k,{key:e.path,link:e})}))},x=function(e){var t=e.navLinks;return r.a.createElement("header",{className:"border-bottom border-secondary mb-3"},r.a.createElement("div",{className:"align-items-center my-2 row"},r.a.createElement("h1",{className:"col-auto h5 mb-0"},r.a.createElement(R.a,{to:"/",exact:!0,className:"text-white"},"Movie Ratings")),r.a.createElement("div",{className:"col text-right"},r.a.createElement(j,{navLinks:t}))))},O={img:{attributionUrl:"https://www.themoviedb.org/assets/1/v4/logos/408x161-powered-by-rectangle-green-bb4301c10ddc749b4e79463811a68afebeae66ef43d17bcfd8ff0e60ded7ce99.png",baseUrl:"https://image.tmdb.org/t/p/",backdropSize:"w1280",fallbackUrl:"https://www.themoviedb.org/assets/1/v4/logos/293x302-powered-by-square-blue-ee05c47ab249273a6f9f1dcafec63daba386ca30544567629deb1809395d8516.png",posterSize:"w780"},key:"api_key=6f875d4fba2e999f480afa6275a08f75",pathSearchMovies:"search/movie",url:"https://api.themoviedb.org/3/"},P=r.a.createContext(),F=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={movieInfo:{backdrop_url:O.img.fallbackUrl,id:"",LetterboxdURI:"",overview:"",poster_url:O.img.fallbackUrl,Rating:"",title:"",vote_average:""},movieInfoStatus:""},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.loadMovieInfo(this.props.movie)}},{key:"componentDidUpdate",value:function(e){this.props.movie!==e.movie&&this.loadMovieInfo(this.props.movie)}},{key:"loadMovieInfo",value:function(e){var t=this;void 0!==e&&(this.setState({movieInfoStatus:"loading"}),function(e){return fetch("".concat(O.url).concat(O.pathSearchMovies,"?").concat(O.key,"&query=").concat(e.Name,"&year=").concat(e.Year)).then(function(e){if(!e.ok)throw Error(e.status);return e.json()})}(e).then(function(a){if(!a.results.length)throw Error("No movie found");var n=a.results.find(function(t){return t.title===e.Name&&t.release_date.indexOf(e.Year)>-1});if(void 0===n)throw Error("No movie found");t.setState({movieInfoStatus:"loaded",movieInfo:{backdrop_url:O.img.baseUrl+O.img.backdropSize+n.backdrop_path,id:n.id,LetterboxdURI:e.LetterboxdURI,overview:n.overview,poster_url:O.img.baseUrl+O.img.posterSize+n.poster_path,Rating:e.Rating,title:n.title,vote_average:n.vote_average}})}).catch(function(e){t.setState({movieInfoStatus:"error"}),console.log(e.message)}))}},{key:"render",value:function(){var e=this.props.children;return r.a.createElement(P.Provider,{value:this.state},e)}}]),t}(r.a.Component),C=function(e){var t=e.type,a={error:{icon:"sad-tear",text:"An error has ocurred"},loading:{icon:"hourglass-half",text:"Loading..."},noMovies:{icon:"frown",text:"No movies to show"},noStats:{icon:"frown",text:"No stats to show"},pageNotFound:{icon:"dizzy",text:"Page not found"}};return r.a.createElement("div",{className:"lead p-3 text-center"},r.a.createElement("div",{className:"h3 mb-3"},r.a.createElement("span",{className:"bg-secondary p-2 rounded"},r.a.createElement(D.a,{icon:a[t].icon}))),a[t].text)},I=function(){var e=Object(n.useContext)(P).movieInfo;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"p-3"},r.a.createElement("p",{className:"lead"},e.overview),r.a.createElement("div",{className:"text-right"},r.a.createElement("div",{className:"mb-3"},r.a.createElement("a",{className:"btn btn-danger btn-sm",href:e.LetterboxdURI,target:"_blank",rel:"noopener noreferrer"},"View movie at Letterboxd")),r.a.createElement("div",{className:"mb-3"},r.a.createElement("a",{className:"btn btn-danger btn-sm",href:"https://www.themoviedb.org/movie/".concat(e.id),target:"_blank",rel:"noopener noreferrer"},"View movie at TMDB")))),r.a.createElement("img",{alt:"backdrop for ".concat(e.title),className:"img-fluid rounded-bottom",src:e.backdrop_url}))},L=function(){var e=Object(n.useContext)(P).movieInfo;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"p-3 row"},r.a.createElement("div",{className:"col-6 col-sm-4"},r.a.createElement("img",{alt:"poster for ".concat(e.title),className:"img-fluid",src:e.poster_url})),r.a.createElement("div",{className:"col-6 col-sm-8 text-right"},r.a.createElement("div",{className:"mb-3"},e.Rating," of 5",r.a.createElement(D.a,{className:"ml-1 text-warning",icon:"star"}),r.a.createElement("div",{className:"small"},"by me")),r.a.createElement("div",{className:"mb-3"},e.vote_average," of 10",r.a.createElement(D.a,{className:"ml-1 text-warning",icon:"star"}),r.a.createElement("div",{className:"small"},"by TMDb users")))),r.a.createElement("h1",{className:"bg-secondary h3 mb-0 p-3"},e.title))},U=function(){var e=Object(n.useContext)(P),t=e.movieInfo,a=e.movieInfoStatus;return r.a.createElement(r.a.Fragment,null,"loaded"===a&&""!==t.id&&r.a.createElement("div",{className:"border border-secondary mb-3 rounded"},r.a.createElement(L,null),r.a.createElement(I,null)),("loading"===a||"error"===a)&&r.a.createElement(C,{type:a}))},_=function(e){var t=e.match,a=Object(n.useContext)(N),i=a.movieRatings,o=a.movieRatingsStatus,c=t.params.movieId,s=i.find(function(e){return e.Id===c});return r.a.createElement(r.a.Fragment,null,"loaded"===o&&r.a.createElement(F,{movie:s},r.a.createElement(U,null)),("loading"===o||"error"===o)&&r.a.createElement(C,{type:o}))},W=a(18),Y=a(19),G=function(e){var t,a=e.movie,n=e.type;"Diary"===n?t="watched in ".concat(a.WatchedDateFormatted):"Ratings"===n&&(t="rated in ".concat(a.DateFormatted));for(var i=[],o=0;o<a.Rating;o++)i.push(r.a.createElement(D.a,{key:o,className:"mr-1",icon:"star"}));return r.a.createElement(Y.a,{className:"btn btn-secondary btn-block",to:"/movie/".concat(a.Id)},r.a.createElement("div",{className:"text-left text-truncate"},a.Name,r.a.createElement("span",{className:"ml-1 small"},"(",a.Year,")")),r.a.createElement("div",{className:"align-items-end row small"},r.a.createElement("div",{className:"col text-left text-warning"},i),r.a.createElement("div",{className:"col small text-right"},t)))},T=function(e){var t=e.type,a=Object(n.useState)({increasePage:null,moviesFiltered:[],moviesPaginated:[],moviesStatus:null}),i=Object(W.a)(a,2),o=i[0],c=i[1],s=Object(n.useContext)(y),l=s.getMovieDiaryFiltered,m=s.getMovieDiaryPaginated,v=s.increaseMovieDiaryPage,d=s.movieDiarySearchString,u=s.movieDiaryStatus,g=Object(n.useContext)(N),h=g.getMovieRatingsFiltered,b=g.getMovieRatingsPaginated,f=g.increaseMovieRatingsPage,p=g.movieRatingsSearchString,E=g.movieRatingsStatus;Object(n.useEffect)(function(){"Diary"===t?c({increasePage:v,moviesFiltered:l(),moviesPaginated:m(),moviesStatus:u}):"Ratings"===t&&c({increasePage:f,moviesFiltered:h(),moviesPaginated:b(),moviesStatus:E})},[d,u,p,E,t]);var S=o.increasePage,w=o.moviesFiltered,M=o.moviesPaginated,R=o.moviesStatus;return r.a.createElement(r.a.Fragment,null,"loaded"===R&&!!w.length&&r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"list-unstyled"},M.map(function(e){return r.a.createElement("li",{className:"mb-3",key:e.Id},r.a.createElement(G,{movie:e,type:t}))})),M.length<w.length&&r.a.createElement("div",{className:"mb-3 text-center"},r.a.createElement("button",{className:"btn btn-danger",type:"button",onClick:S},"Show more"))),"loaded"===R&&!w.length&&r.a.createElement(C,{type:"noMovies"}),("loading"===R||"error"===R)&&r.a.createElement(C,{type:R}))},A=function(e){var t=e.type,a=Object(n.useState)({movieSearchString:"",moviesFiltered:[],setMovieSearchString:null}),i=Object(W.a)(a,2),o=i[0],c=i[1],s=Object(n.useContext)(y),l=s.getMovieDiaryFiltered,m=s.movieDiarySearchString,v=s.setMovieDiarySearchString,d=Object(n.useContext)(N),u=d.getMovieRatingsFiltered,g=d.movieRatingsSearchString,h=d.setMovieRatingsSearchString;Object(n.useEffect)(function(){"Diary"===t?c({movieSearchString:m,moviesFiltered:l(),setMovieSearchString:v}):"Ratings"===t&&c({movieSearchString:g,moviesFiltered:u(),setMovieSearchString:h})},[m,g,t]);var b=o.movieSearchString,f=o.moviesFiltered,p=o.setMovieSearchString;return r.a.createElement("div",{className:"mb-3"},r.a.createElement("div",{className:"input-group input-group-sm mb-1"},r.a.createElement("input",{id:"search-movie",className:"form-control",placeholder:"Search...",type:"text",value:b,onChange:function(e){return p(e.target.value)}}),r.a.createElement("span",{className:"input-group-append"},r.a.createElement("button",{className:"btn btn-secondary",type:"button",onClick:function(){return p("")}},r.a.createElement(D.a,{icon:"times"})))),r.a.createElement("p",{className:"small text-right"},f.length," movies"))},z=function(e){var t=e.type;return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",{className:"h4"},t),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-12 col-sm-4"},r.a.createElement(A,{type:t})),r.a.createElement("div",{className:"col-12 col-sm-8"},r.a.createElement(T,{type:t}))))},B=function(){return r.a.createElement(C,{type:"pageNotFound"})},q=function(e){var t=e.width;return r.a.createElement("div",{className:"bg-secondary rounded"},r.a.createElement("div",{className:"bg-danger pb-2 rounded",style:{width:"".concat(t,"%")}}))},J=function(e){var t=e.getMovies,a=e.moviesStatus,n=e.type,i=t(),o=[];if("loading"===a||"error"===a)o.push(r.a.createElement(C,{key:a,type:a}));else if(i.groups){var c=function(e){var t=100*i.groups[e]/i.max;o.unshift(r.a.createElement("div",{className:"mb-2",key:e},r.a.createElement("div",{className:"no-gutters row"},r.a.createElement("div",{className:"col-auto"},function(){if("moviesPerRatingGiven"===n){for(var t=[],a=0;a<e;a++)t.push(r.a.createElement(D.a,{key:a,className:"mr-1 text-warning",icon:"star"}));return t}return e}()),r.a.createElement("div",{className:"col font-weight-bold text-right"},i.groups[e])),r.a.createElement(q,{width:t})))};for(var s in i.groups)c(s)}else o.push(r.a.createElement(C,{key:"noStats",type:"noStats"}));return o},V=function(){var e=Object(n.useContext)(y),t=e.getMoviesPerYearWatched,a=e.movieDiaryStatus,i=Object(n.useContext)(N),o=i.getMoviesPerDecadeReleased,c=i.getMoviesPerRatingGiven,s=i.movieRatingsStatus;return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",{className:"h4"},"Stats"),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-12 col-sm-6 col-md-4 mb-3"},r.a.createElement("div",{className:"border border-secondary p-3 rounded"},r.a.createElement("h1",{className:"h5"},"Per year watched"),r.a.createElement(J,{getMovies:t,moviesStatus:a,type:"moviesPerYearWatched"}))),r.a.createElement("div",{className:"col-12 col-sm-6 col-md-4 mb-3"},r.a.createElement("div",{className:"border border-secondary p-3 rounded"},r.a.createElement("h1",{className:"h5"},"Per rating given"),r.a.createElement(J,{getMovies:c,moviesStatus:s,type:"moviesPerRatingGiven"}))),r.a.createElement("div",{className:"col-12 col-sm-6 col-md-4 mb-3"},r.a.createElement("div",{className:"border border-secondary p-3 rounded"},r.a.createElement("h1",{className:"h5"},"Per decade released"),r.a.createElement(J,{getMovies:o,moviesStatus:s,type:"moviesPerDecadeReleased"})))))},$=function(){return r.a.createElement("div",{className:"border-secondary border-top pt-3 small text-center"},r.a.createElement("div",{className:"mb-3"},"My Ratings and Diary data are exported from Letterboxd from time to time.",r.a.createElement("br",null),"So my ",r.a.createElement("a",{className:"text-danger",href:"https://letterboxd.com/saviomd",target:"_blank",rel:"noopener noreferrer"},"profile")," will have more up to date information."),r.a.createElement("div",{className:"mb-3"},r.a.createElement("img",{alt:"Powered by TMDB",className:"mr-1",src:O.img.attributionUrl,height:"32"}),r.a.createElement("br",null),"This product uses the TMDb API but is not endorsed or certified by TMDb."))};a(35);h.b.add(b.a,b.b,b.c,b.d,b.e,b.f,b.g,b.h);var H=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={navLinks:[{icon:"star",name:"Ratings",path:"/"},{icon:"calendar-alt",name:"Diary",path:"/diary"},{icon:"chart-bar",name:"Stats",path:"/stats"}]},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(S,null,r.a.createElement(w,null,r.a.createElement("div",{className:"container-fluid"},r.a.createElement("div",{className:"justify-content-center row"},r.a.createElement("div",{className:"col-12 col-md-10"},r.a.createElement(x,{navLinks:this.state.navLinks}),r.a.createElement(u.a,null,r.a.createElement(g.a,{path:"/",exact:!0,render:function(){return r.a.createElement(z,{type:"Ratings"})}}),r.a.createElement(g.a,{path:"/diary",render:function(){return r.a.createElement(z,{type:"Diary"})}}),r.a.createElement(g.a,{path:"/movie/:movieId",render:function(e){var t=e.match;return r.a.createElement(_,{match:t})}}),r.a.createElement(g.a,{path:"/stats",render:function(){return r.a.createElement(V,null)}}),r.a.createElement(g.a,{component:B})),r.a.createElement($,null),r.a.createElement(M,null))))))}}]),t}(r.a.Component),K=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Q(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var X=r.a.createElement(c.a,null,r.a.createElement(H,null));o.a.render(X,document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/movieratings",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/movieratings","/service-worker.js");K?(function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Q(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):Q(t,e)})}}()}},[[24,1,2]]]);
//# sourceMappingURL=main.0927f322.chunk.js.map